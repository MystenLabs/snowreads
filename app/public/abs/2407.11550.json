{"id":"2407.11550","title":"Ada-KV: Optimizing KV Cache Eviction by Adaptive Budget Allocation for\n  Efficient LLM Inference","authors":"Yuan Feng and Junlin Lv and Yukun Cao and Xike Xie and S. Kevin Zhou","authorsParsed":[["Feng","Yuan",""],["Lv","Junlin",""],["Cao","Yukun",""],["Xie","Xike",""],["Zhou","S. Kevin",""]],"versions":[{"version":"v1","created":"Tue, 16 Jul 2024 09:53:32 GMT"},{"version":"v2","created":"Sun, 21 Jul 2024 14:08:42 GMT"},{"version":"v3","created":"Fri, 16 Aug 2024 08:46:33 GMT"}],"updateDate":"2024-08-19","timestamp":1721123612000,"abstract":"  Large Language Models have excelled in various fields but encounter\nchallenges in memory and time efficiency due to the expanding Key-Value (KV)\ncache required for long-sequence inference. Recent efforts try to reduce KV\ncache size to a given memory budget by evicting vast non-critical cache\nelements during runtime, while preserving generation quality. Our revisiting of\ncurrent eviction methods reveals that they fundamentally minimize an upper\nbound of the $L_1$ eviction loss between the pre- and post-eviction outputs of\nmulti-head self-attention mechanisms. Moreover, our analysis indicates that the\ncommon practices of uniformly assigning budgets across attention heads harm\ntheir post-eviction generation quality. In light of these findings, we propose\na simple yet effective adaptive budget allocation algorithm. This algorithm not\nonly optimizes the theoretical loss upper bound but also reduces the $L_1$\neviction loss in practice by aligning with the varied characteristics across\ndifferent heads. By integrating this algorithm into two state-of-the-art\nmethods, we demonstrate the effectiveness of using adaptive budget allocation\nto optimize KV cache eviction. Extensive evaluations on 16 datasets and the\nNeedle-in-a-Haystack test confirm significant performance improvements across\nvarious tasks.\n","subjects":["Computing Research Repository/Computation and Language","Computing Research Repository/Artificial Intelligence"],"license":"http://creativecommons.org/licenses/by/4.0/"}